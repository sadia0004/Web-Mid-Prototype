<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Up - PropertyPilot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded shadow-md w-full max-w-md">
    <h2 class="text-2xl font-bold mb-6 text-center text-indigo-700">Create Account</h2>
    <form id="signupForm" class="space-y-4" enctype="multipart/form-data">
      <input type="text" id="fullName" placeholder="Full Name" class="w-full p-2 border rounded" required />
      <input type="email" id="email" placeholder="Email" class="w-full p-2 border rounded" required />
      <input type="password" id="password" placeholder="Password" class="w-full p-2 border rounded" required />
      <input type="text" id="nidNumber" placeholder="NID Number" class="w-full p-2 border rounded" required />
      
      <label class="block text-gray-700 font-semibold">Upload Profile Picture (optional)</label>
      <input type="file" id="profilePhoto" accept="image/*" class="w-full p-2 border rounded" />
      
      <select id="role" class="w-full p-2 border rounded" required>
        <option value="" disabled selected>Select Role</option>
        <option value="tenant">Tenant</option>
        <option value="landlord">Landlord</option>
      </select>
      
      <button type="submit" class="w-full bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700">Sign Up</button>
      <p class="text-sm text-center mt-4">
        Already have an account? 
        <a href="login.html" class="text-indigo-600 hover:underline">Login</a>
      </p>
    </form>
  </div>

  <script>
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });
    }

    document.getElementById('signupForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const fullName = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const nidNumber = document.getElementById('nidNumber').value.trim();
      const role = document.getElementById('role').value;
      const photoInput = document.getElementById('profilePhoto');

      if (!fullName || !email || !password || !nidNumber || !role) {
        alert("Please fill all required fields.");
        return;
      }

      let users = JSON.parse(localStorage.getItem('users')) || [];

      if (users.some(user => user.email.toLowerCase() === email.toLowerCase())) {
        alert("Email already registered.");
        return;
      }

      let profilePhotoBase64 = "";
      if (photoInput.files.length > 0) {
        try {
          profilePhotoBase64 = await toBase64(photoInput.files[0]);
        } catch (error) {
          alert("Error reading profile picture.");
          return;
        }
      }

      const newUser = { 
        fullName, 
        email, 
        password, 
        nidNumber, 
        role,
        profilePhoto: profilePhotoBase64
      };

      users.push(newUser);
      localStorage.setItem('users', JSON.stringify(users));

      alert("Account created successfully!");
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
